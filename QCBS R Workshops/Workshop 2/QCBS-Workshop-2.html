<!DOCTYPE html>
<html>
  <head>
    <title>Workshop 2: Loading and Manipulating Data</title>
    <meta charset="utf-8">
    <meta name="author" content="Québec Centre for Biodiversity Science" />
    <link href="assets/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link rel="stylesheet" href="assets/font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="assets/academicons-1.8.1/css/academicons.min.css">
    <link rel="stylesheet" href="qcbsR.css" type="text/css" />
    <link rel="stylesheet" href="qcbsR-fonts.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Workshop 2: Loading and Manipulating Data
## QCBS R Workshop Series
### Québec Centre for Biodiversity Science

---









## Learning Objectives

1. Writing a script
2. Loading, exploring and saving data
3. Fixing a broken data frame


---
## R Scripts

* What is this?
   - A text file that contains all of the commands that you will use

* Once written and saved, your script file allows you to make changes and re-run analyses with minimal effort!
  - Just highlight text and click "run" or press command+enter (Mac) or ctrl+enter (PC)


---
## Create an R script

.center[
![:scale 80%](images/1_Create_an_R_script.png)
]


---
## Create an R script


.center[
![:scale 90%](images/2_Create_an_R_script2.Mod_arrow.png)
]


---
## Commands &amp; comments
The `#` symbol in a script tells R to ignore anything remaining on this line of the script when running commands


```r
# This is a comment not a command
```


---
## Commenting / documenting

* annotating someone’s script is a good way to learn
* remember what you did
* tell collaborators what you did
* good step towards reproducible science


---
## Header

It is recommended that you start your script with a header using comments:

.center[
![:scale 75%](images/3_Header.Mod_arrow.png)
]


---
## Section Headings

You can make a section heading in R Studio four `#` signs


```r
##
## Heading name ####
```

This allows you to move quickly between sections and hide sections

.center[
![:scale 70%](images/4_Section_headings_Mod_arrow 2.png)
]


---
## Housekeeping

The first command at the top of all scripts should be: `rm(list = ls())`. This:

* Clears R memory
* Prevents errors such as use of older data

---
## Clearing the workspace


```r
# Clear the R workspace
rm(list = ls())
?rm
?ls
```

---
## Housekeeping

Demo – Try to add some test data to R and then see how `rm(list = ls())` removes it



```r
A &lt;- "Test"
A
# [1] "Test"
rm(list=ls())
A
# Error in eval(expr, envir, enclos): objet 'A' introuvable
```

---
## Remember

* R is ready for commands when you see the chevron `&gt;` in the console. If you don't see it, press ESC
* R is case sensitive!


---
class: inverse, center, middle

# Loading, exploring and saving data

---
## Download today's data

You can download the data &amp; script from:

http://qcbs.ca/wiki/r/workshop2

Save the files somewhere convenient on your computer and remember the path to the directory that contains the files.


---
## Working Directory

Tells R where your scripts and data are. You need to set the right working directory to load a data file.
Type in the console to see your working directory:


```r
getwd()
```

When you load a script, RStudio automatically sets the directory to the folder containing the script.

a “/” separates folders and file

---
## Setting working directory

![:scale 5%](images/Logos_and_icons/apple_logo.png)


```r
setwd('/Users/Garou/Desktop/QCBS_R')
```


![:scale 5%](images/Logos_and_icons/Windows_logo.png)


```r
setwd('C:/Users/Britney/Documents/PhD/R_Workshop2')
```

---
## Setting working directory

Alternatively:
```r
setwd(choose.dir())
```

This gives you a pop up to navigate to appropriate directory (might not work on a mac).

You can also set your working directory by clicking on session / set working directory / choose directory


---
## Display contents of the directory

You can display contents of the working directory using `dir()`.


```r
dir()
```

It helps to:

* Check that the file you plan to open is present in the folder that R is currently working in
* Check for correct spelling (e.g. "co2_good.csv" instead of "CO2_good.csv")


---
## Importing Data

Import data into R using `read.csv`:


```r
CO2 &lt;- read.csv("co2_good.csv", header=TRUE)
```

New object in R

File name within quotation marks ('file' or "file")

`header=TRUE` Tells R that the first line contains column names not data

---
## Importing Data

.alert[Recall] to find out what arguments the function requires, use help “?”


```r
?read.csv
```

.alert[Important] if your operating system or CSV editor (e.g. Excel) is in French, then use `read.csv2`


```r
?read.csv2
```

---
## Importing Data

.center[
![](images/5_Importing_data_Mod_arrow.png)
]


Notice that R-Studio now provides information on the CO2 data in your workspace

The workspace refers to all the objects that you create during an R session.


---
## Looking at Data

R code  					| action
----------------- | -------------
`CO2`					  		| look at the whole dataframe
`head(CO2)`		  		| look at the first few rows
`names(CO2)`				| names of the columns in the dataframe
`attributes(CO2)`		| attributes of the dataframe
`ncol(CO2)`					| number of columns
`nrow(CO2)`					| number of rows
`summary(CO2)`			| summary statistics



---
## Looking at Data


```r
str(CO2)
# 'data.frame':	84 obs. of  5 variables:
#  $ Plant    : Factor w/ 12 levels "Mc1","Mc2","Mc3",..: 10 10 10 10 10 10 10 11 11 11 ...
#  $ Type     : Factor w/ 2 levels "Mississippi",..: 2 2 2 2 2 2 2 2 2 2 ...
#  $ Treatment: Factor w/ 2 levels "chilled","nonchilled": 2 2 2 2 2 2 2 2 2 2 ...
#  $ conc     : int  95 175 250 350 500 675 1000 95 175 250 ...
#  $ uptake   : num  16 30.4 34.8 37.2 35.3 39.2 39.7 13.6 27.3 37.1 ...
```
This shows the structure of the dataframe.
Very useful to check data type (mode) of all columns to make sure R loaded data properly.

.small[Note: the CO2 dataset includes repeated measurements of CO2 uptake from 6 plants from Quebec and 6 plants from Mississippi at several levels of CO2 concentration. Half the plants of each type were chilled overnight before the experiment was conducted.]


---
## Looking at Data

**Common problems:**

* Factors loaded as text (character) or vice versa
* Factor includes too many levels because of typo
* Data (integer or numeric) is loaded as character because of typo (e.g. a space or a "," instead of a "." for decimal numbers)


---
## Looking at Data

`data()`, `head()`, `str()`, `names()`, `attributes()`, `summary()`, `ncol()`, `nrow()`

Load the data with:


```r
CO2 &lt;- read.csv("CO2_good.csv", header = FALSE)
```
Check data types with `str()` again. What is wrong here?

.comment[Don't forget to re-load data with* **header = T** *afterward]

---
## Reminder : Accessing data

A data frame called *mydata*


```r
mydata[1,] # Extracts the first row

mydata[2,3] # Extracts the content of row 2 / column 3

mydata[,1] # Extracts the first column

mydata$Variable1 # Also extracts the first column
```

.center[
![:scale 45%](images/Table_Reminder_from_Workshop_1_Accessing_data.png)
]


---
## Data exploration
Plot of all variable combinations (very useful!)


```r
plot(CO2)
```

Want to see if one of your variable is normally distributed? Try `hist()`


```r
hist(CO2$uptake)
```

.comment[Recall from workshop 1 that the `$` sign is used to extract a column from a data frame.]


---
## Data exploration ![:cube]()

Calculate and save the mean of one of your columns


```r
conc_mean &lt;- mean(CO2$conc)
```

`conc_mean` ![:faic](arrow-right) New object (name)

`mean()` ![:faic](arrow-right) Function 

`CO2` ![:faic](arrow-right) Data frame (name)

`conc` ![:faic](arrow-right) Column (name)

---
## Data exploration ![:cube]()

Run object name to see output


```r
conc_mean
# [1] 435
```

Try with standard deviation as well:


```r
sd(CO2$conc)
# [1] 295.9241
```
Mean concentration is 435 and standard deviation is 295.92!


---
## Data exploration ![:cube]()


Use `apply()` to calculate the means of the last two columns of the data frame (i.e. the columns that contain continuous data)


```r
?apply
```


---
## Data exploration ![:cube]()

Use `apply()` to calculate the means of the last two columns of the data frame (i.e. the columns that contain continuous data)


```r
?apply
```


```r
apply(CO2[,4:5], MARGIN = 2, FUN = mean)
#     conc   uptake 
# 435.0000  27.2131
```


---
## Saving your Workspace



```r
# Saving an R workspace file
save.image(file="CO2_project_Data.RData")


# Clear your memory
rm(list = ls())

 
# Reload your data
load("CO2_project_Data.RData")
head(CO2) # looking good!
#   Plant   Type  Treatment conc uptake
# 1   Qn1 Quebec nonchilled   95   16.0
# 2   Qn1 Quebec nonchilled  175   30.4
# 3   Qn1 Quebec nonchilled  250   34.8
# 4   Qn1 Quebec nonchilled  350   37.2
# 5   Qn1 Quebec nonchilled  500   35.3
# 6   Qn1 Quebec nonchilled  675   39.2
```

---
## Exporting data


```r
write.csv(CO2, file = "CO2_new.csv")
```

`CO2` ![:faic](arrow-right) Object (name)

`"CO2_new.csv"` ![:faic](arrow-right) File to write (name)

---
## Preparing data for R

Comma separated files (.csv) in Data folder

* can be created from almost all applications (Excel, LibreOffice, GoogleDocs)
* file -&gt; save as csv…

.center[
![:scale 85%](images/Excel_csv_good_bad/excel_vs_csv.png)
]



---
## Preparing data for R

Short informative column headings
- starting with a letter
- no spaces

.center[
![:scale 50%](images/Excel_csv_good_bad/excel_colnames.png)
]

---
## Preparing data for R

Column values match their intended use

* No text in numeric columns
  * do not include spaces!
  * NA (not available) is allowed, but blank entries will automatically be replaced with NA so no need to add yourself.

.center[
![:scale 90%](images/Excel_csv_good_bad/excel_values.png)
]


---
## Preparing data for R

Column values match their intended use


* No text in numeric columns
  * do not include spaces!
  * NA (not available) is allowed, but blank entries will automatically be replaced with NA so no need to add yourself.
* Avoid numeric values for data that does not have numeric meaning
  * Subject, Replicate, Treatment: 1,2,3 -&gt; A,B,C or S1,S2,S3 or …



---
## Preparing data for R

* no notes!
* no additional headings!
* no merged cells!

.center[
![:scale 80%](images/Excel_csv_good_bad/excel_notes.png)
]


---
## Preparing data for R

It is possible to do all your data preparation work within R

* Saves time for large datasets
* Keeps original data intact
* Keeps track of the manipulation and transformation you did
* Can switch between long and wide easily (more on this in workshop 4)
* Useful page: https://www.zoology.ubc.ca/~schluter/R/data/


---
## Use your data ![:cube]()

* Try to load, explore, plot, and save your own data in R*
* If it doesn’t load properly, try to make the appropriate changes
* Remember to clear your workspace first!
* When you are finished, try opening your exported data in excel

.comment[*If you don’t have your own data, work with your neighbour]


---
class: inverse, center, middle

# Fixing a broken data frame

---
## Harder Challenge ![:cube]()

Read in the file "CO2_broken.csv"


```r
CO2 &lt;- read.csv("co2_broken.csv")
head(CO2)
#               NOTE..It.rain.a.lot.in.Quebec.during.sampling
# 1 falling on my notebook numerous values can't be read rain
# 2                      Plant\tType\tTreatment\tconc\tuptake
# 3                           Qn1\tQuebec\tnonchilled\t95\t16
# 4                        Qn1\tQuebec\tnonchilled\t175\t30.4
# 5           Qn1\tQuebec\tnonchilled\t250\tcannot_read_notes
# 6                        Qn1\tQuebec\tnonchilled\t350\t37.2
#   due.to.excessive  X X.1 X.2 X.3
# 1               NA NA  NA  NA  NA
# 2               NA NA  NA  NA  NA
# 3               NA NA  NA  NA  NA
# 4               NA NA  NA  NA  NA
# 5               NA NA  NA  NA  NA
# 6               NA NA  NA  NA  NA
```

---
## Harder Challenge ![:cube]()

* This is probably what your data or the data you downloaded looks like
* You can fix the data frame in R (or not…)
* Please give it a try before looking at the script provided
* Work with your neighbors and have FUN!


```
#               NOTE..It.rain.a.lot.in.Quebec.during.sampling
# 1 falling on my notebook numerous values can't be read rain
# 2                      Plant\tType\tTreatment\tconc\tuptake
# 3                           Qn1\tQuebec\tnonchilled\t95\t16
# 4                        Qn1\tQuebec\tnonchilled\t175\t30.4
#   due.to.excessive  X X.1 X.2 X.3
# 1               NA NA  NA  NA  NA
# 2               NA NA  NA  NA  NA
# 3               NA NA  NA  NA  NA
# 4               NA NA  NA  NA  NA
```



---
## Fixing CO2_broken ![:cube]()

Some useful functions:

* `?read.csv` - look at some of the options for how to load a .csv
* `head()`
* `str()`
* `class()`
* `unique()`
* `levels()`
* `which()`
* `droplevels()`

.alert[HINT] There are 4 problems!

---
## Broken data

.alert[ERROR 1]

The data appears to be lumped into one column


```r
head(CO2)
#               NOTE..It.rain.a.lot.in.Quebec.during.sampling
# 1 falling on my notebook numerous values can't be read rain
# 2                      Plant\tType\tTreatment\tconc\tuptake
# 3                           Qn1\tQuebec\tnonchilled\t95\t16
# 4                        Qn1\tQuebec\tnonchilled\t175\t30.4
# 5           Qn1\tQuebec\tnonchilled\t250\tcannot_read_notes
# 6                        Qn1\tQuebec\tnonchilled\t350\t37.2
#   due.to.excessive  X X.1 X.2 X.3
# 1               NA NA  NA  NA  NA
# 2               NA NA  NA  NA  NA
# 3               NA NA  NA  NA  NA
# 4               NA NA  NA  NA  NA
# 5               NA NA  NA  NA  NA
# 6               NA NA  NA  NA  NA
```

---
## Broken data

.alert[ERROR 1] - Solution

* Re-import the data, but specify the separation among entries
* The sep argument tells R what character separates the values on each line of the file
* Here, "TAB" was used instead of ","


```r
CO2 &lt;- read.csv("co2_broken.csv",sep = "")
```

---
## Broken data

.alert[ERROR 2]

The data does not start until the third line of the file, so you end up with notes on the file as the headings.


```r
head(CO2)
#     NOTE.     It       rain        a               lot    in. Quebec
# 1 falling     on         my notebook          numerous values  can't
# 2   Plant   Type  Treatment     conc            uptake              
# 3     Qn1 Quebec nonchilled       95                16              
# 4     Qn1 Quebec nonchilled      175              30.4              
# 5     Qn1 Quebec nonchilled      250 cannot_read_notes              
# 6     Qn1 Quebec nonchilled      350              37.2              
#   during sampling.      due to excessive X....
# 1     be      read rain,,,, NA        NA    NA
# 2                           NA        NA    NA
# 3                           NA        NA    NA
# 4                           NA        NA    NA
# 5                           NA        NA    NA
# 6                           NA        NA    NA
```


---
## Broken data

.alert[ERROR 2] - Solution

Skip two lines when loading the file using the "skip" argument:


```r
CO2&lt;-read.csv("co2_broken.csv", sep = "", skip = 2)
head(CO2)
#   Plant   Type  Treatment              conc            uptake
# 1   Qn1 Quebec nonchilled                95                16
# 2   Qn1 Quebec nonchilled               175              30.4
# 3   Qn1 Quebec nonchilled               250 cannot_read_notes
# 4   Qn1 Quebec nonchilled               350              37.2
# 5   Qn1 Quebec nonchilled               500              35.3
# 6   Qn1 Quebec nonchilled cannot_read_notes              39.2
```

---
## Broken data

.alert[ERROR 3]

`conc` and `uptake` variables are considered factors instead of numbers, because there are comments in the numeric columns


```r
str(CO2)
# 'data.frame':	84 obs. of  5 variables:
#  $ Plant    : Factor w/ 12 levels "Mc1","Mc2","Mc3",..: 10 10 10 10 10 10 10 11 11 11 ...
#  $ Type     : Factor w/ 2 levels "Mississippi",..: 2 2 2 2 2 2 2 2 2 2 ...
#  $ Treatment: Factor w/ 4 levels "chiled","chilled",..: 4 4 4 4 4 4 4 4 4 3 ...
#  $ conc     : Factor w/ 8 levels "1000","175","250",..: 7 2 3 4 5 8 1 7 2 3 ...
#  $ uptake   : Factor w/ 77 levels "10.5","10.6",..: 15 39 76 54 50 61 63 9 32 53 ...
```

* Due to missing values entered as "cannot_read_notes" and "na"
* Recall that R only recognizes "NA" (capital)

---
## `?read.csv`

![:scale 80%](images/read_table_help1.png)

![:scale 80%](images/read_table_help2.png)


---
## Broken data

.alert[ERROR 3] - Solution

Tell R that all of NA, "na", and "cannot_read_notes" should be considered NA. Then because all other values in those columns are numbers, `conc` and `uptake` will be loaded as numeric/integer.



```r
CO2 &lt;- read.csv("co2_broken.csv", sep = "", skip = 2,
                na.strings = c("NA","na","cannot_read_notes"))
str(CO2)
# 'data.frame':	84 obs. of  5 variables:
#  $ Plant    : Factor w/ 12 levels "Mc1","Mc2","Mc3",..: 10 10 10 10 10 10 10 11 11 11 ...
#  $ Type     : Factor w/ 2 levels "Mississippi",..: 2 2 2 2 2 2 2 2 2 2 ...
#  $ Treatment: Factor w/ 4 levels "chiled","chilled",..: 4 4 4 4 4 4 4 4 4 3 ...
#  $ conc     : int  95 175 250 350 500 NA 1000 95 175 250 ...
#  $ uptake   : num  16 30.4 NA 37.2 35.3 39.2 39.7 13.6 27.3 37.1 ...
```

---
## Broken data

.alert[ERROR 4]

There are only 2 treatments (chilled and nonchilled) but there are spelling errors causing it to look like 4 different treatments.


```r
str(CO2)
```


```r
levels(CO2$Treatment)
# [1] "chiled"     "chilled"    "nnchilled"  "nonchilled"
unique(CO2$Treatment)
# [1] nonchilled nnchilled  chilled    chiled    
# Levels: chiled chilled nnchilled nonchilled
```

---
## Broken data

.alert[ERROR 4] - Solution



```r
# Identify all rows that contain "nnchilled" and replace with "nonchilled"
CO2$Treatment[CO2$Treatment=="nnchilled"] &lt;- "nonchilled"

# Identify all rows that contain "chiled" and replace with "chilled"
CO2$Treatment[CO2$Treatment=="chiled"] &lt;- "chilled"

# Drop unused levels from factor
CO2 &lt;- droplevels(CO2)
str(CO2)
# 'data.frame':	84 obs. of  5 variables:
#  $ Plant    : Factor w/ 12 levels "Mc1","Mc2","Mc3",..: 10 10 10 10 10 10 10 11 11 11 ...
#  $ Type     : Factor w/ 2 levels "Mississippi",..: 2 2 2 2 2 2 2 2 2 2 ...
#  $ Treatment: Factor w/ 2 levels "chilled","nonchilled": 2 2 2 2 2 2 2 2 2 2 ...
#  $ conc     : int  95 175 250 350 500 NA 1000 95 175 250 ...
#  $ uptake   : num  16 30.4 NA 37.2 35.3 39.2 39.7 13.6 27.3 37.1 ...
```

Fixed!


---
class: inverse, center, bottom

# Thank you for attending!

![:scale 50%](images/qcbs_logo.png)
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="qcbsR-macros.js"></script>
<script>var slideshow = remark.create();
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
  }
});
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
