<!DOCTYPE html>
<html>
  <head>
    <title>Workshop 2: Loading and Manipulating Data</title>
    <meta charset="utf-8">
    <meta name="author" content="Québec Centre for Biodiversity Science" />
    <link href="assets/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link rel="stylesheet" href="assets/font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="assets/academicons-1.8.1/css/academicons.min.css">
    <link rel="stylesheet" href="qcbsR.css" type="text/css" />
    <link rel="stylesheet" href="qcbsR-fonts.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Workshop 2: Loading and Manipulating Data
## QCBS R Workshop Series
### Québec Centre for Biodiversity Science

---








## Learning Objectives

1. Creating an R project 
2. Writing a script
3. Loading, exploring and saving data
4. Learn to manipulate data frames with tidyr, dplyr, maggritr 

---
## RStudio projects 

* What is this? 
  - Within RStudio, Projects make it easy to separate and keep your work organized.  
  - All files, scripts, documentation related to a specific project are bound together

* Encourages reproducibility and easy sharing. 

---
## Create a new project 

Use the **Create project** command (available in the Projects menu and the global toolbar)

.center[
![:scale 60%](images/0_Create_a_new_project.png)]

---
## Keep your files organized! 

One project = one folder :)

.center[
![:scale 60%](images/0_folderData1.png)]


---
## Preparing data for R

Dataset should be stored as comma separated files (.csv) in Data folder

* can be created from almost all applications (Excel, LibreOffice, GoogleDocs)
* file -&gt; save as csv…

.center[
![:scale 45%](images/Excel_csv_good_bad/excel_vs_csv.png)
]



---
## Choose filenames names wisely

.pull-left[
**Good!** 
- rawDatasetAgo2017.csv
- co2_concentrations_QB.csv
- 01_figIntro.R]

.pull-right[
**Bad!** 
- final.csv (*Uninformative!*)
- safnnejs.csv (*Random!*)
- 1-4.csv  (*Avoid using numbers!*)
- Dont.separate.names.with.dots.csv (*Can lead to reading file errors!*)]



---
## Choose variable names wisely

.pull-left[
**Good!**
  - Measurements
  - SpeciesNames
  - Site ]

.pull-right[
**Bad!** 
 - a
 - 3
 - supercomplicatedverylongname]

---
## Things to consider with your data! 
 

.pull-left[
* No text in numeric columns
* do not include spaces!
* NA (not available) is allowed,blank entries will automatically be replaced with NA
* Name your variables informatively
* Look for typos]

.pull-right[
* Avoid numeric values for data without numeric meaning
* Use CONSISTENT formats for dates, numbers, metrics, etc.
* no notes!
* no additional headings!
* no merged cells!]

---
## Bad data examples: 

.pull-left[
![:scale 100%](images/Excel_csv_good_bad/excel_values.png)]

.pull-right[
![:scale 100%](images/Excel_csv_good_bad/excel_notes.png)
]

---
## Horrible data examples: 

Bad data preservation practices 

.center[
![:scale 80%](images/HorribleData.png)]


---
## Preparing data in R

It is possible to do all your data preparation work within R

* Saves time for large datasets
* Keeps original data intact
* Keeps track of the manipulation and transformation you did
* Can switch between long and wide easily (more on this later and in workshop 4)
* Useful page: https://www.zoology.ubc.ca/~schluter/R/data/

---
class: inverse, center, middle

# Writing a Script

---
## R Scripts

* What is this?
   - A text file that contains all of the commands that you will use

* Once written and saved, your script file allows you to make changes and re-run analyses with minimal effort!
  - Just highlight text and click "run" or press command+enter (Mac) or ctrl+enter (PC)


---
## Create an R script

.center[
![:scale 80%](images/1_Create_an_R_script.png)
]

---
## Create an R script


.center[
![:scale 90%](images/2_Create_an_R_script2.Mod_arrow.png)
]


---
## Commands &amp; comments
The `#` symbol in a script tells R to ignore anything remaining on this line of the script when running commands


```r
# This is a comment not a command
```


---
## Commenting / documenting

* annotating someone’s script is a good way to learn
* remember what you did
* tell collaborators what you did
* good step towards reproducible science
* be as detailed as possible 


---
## Header

It is recommended that you start your script with a header using comments:

.center[
![:scale 75%](images/3_Header.Mod_arrow.png)
]


---
## Section Headings

You can make a section heading in R Studio four `#` signs


```r
##
## Heading name ####
```

This allows you to move quickly between sections and hide sections

.center[
![:scale 70%](images/4_Section_headings_Mod_arrow 2.png)
]


---
## Housekeeping 

The first command at the top of all scripts should be: `rm(list = ls())`. This:

* Clears R memory
* Prevents errors such as use of older data

---
## Clearing the workspace


```r
# Clear the R workspace
rm(list = ls())
?rm
?ls
```

---
## Housekeeping

Demo – Try to add some test data to R and then see how `rm(list = ls())` removes it



```r
A&lt;-"Test" # Put some data in workspace 
A &lt;- "Test" # Note that you can use spaces! 
A = "Test" # &lt;- or = can be used equally 

#Note that it is best practice to use "&lt;-" for assigment instead of "="
A
# [1] "Test"
rm(list=ls())
A
# Error in eval(expr, envir, enclos): objet 'A' introuvable
```

---
## Remember

* R is ready for commands when you see the chevron `&gt;` in the console. If you don't see it, press ESC
* R is case sensitive!


---
class: inverse, center, middle

# Loading, exploring and saving data

---
## Download today's data

You can download the data &amp; script from:

http://qcbs.ca/wiki/r/workshop2

Save the files in the folder where your created your R project. 

---
## Working Directory

Tells R where your scripts and data are. You need to set the right working directory to load a data file.
Type in the console to see your working directory:


```r
getwd()
```

When you load a script, RStudio automatically sets the directory to the folder containing the script.

a “/” separates folders and file

---
## Display contents of the directory

You can display contents of the working directory using `dir()`.


```r
dir()
```

It helps to:

* Check that the file you plan to open is present in the folder that R is currently working in
* Check for correct spelling (e.g. "co2_good.csv" instead of "CO2_good.csv")


---
## Importing Data

Import data into R using `read.csv`:


```r
CO2 &lt;- read.csv("co2_good.csv", header=TRUE)
```

New object in R

File name within quotation marks ('file' or "file")

`header=TRUE` Tells R that the first line contains column names not data

---
## Importing Data

.alert[Recall] to find out what arguments the function requires, use help “?”


```r
?read.csv
```

.alert[Important] if your operating system or CSV editor (e.g. Excel) is in French, then use `read.csv2`


```r
?read.csv2
```

---
## Importing Data

.center[
![](images/5_Importing_data_Mod_arrow.png)
]


Notice that R-Studio now provides information on the CO2 data in your workspace

The workspace refers to all the objects that you create during an R session.


---
## Looking at Data

R code  					| action
----------------- | -------------
`CO2`					  		| look at the whole dataframe
`head(CO2)`		  		| look at the first few rows
`tail(CO2)`         | look at the last few rows
`names(CO2)`				| names of the columns in the dataframe
`attributes(CO2)`		| attributes of the dataframe
`dim(CO2)`          | dimensions of the dataframe 
`ncol(CO2)`					| number of columns
`nrow(CO2)`					| number of rows


---
## Looking at Data


```r
str(CO2)
# 'data.frame':	84 obs. of  5 variables:
#  $ Plant    : Factor w/ 12 levels "Mc1","Mc2","Mc3",..: 10 10 10 10 10 10 10 11 11 11 ...
#  $ Type     : Factor w/ 2 levels "Mississippi",..: 2 2 2 2 2 2 2 2 2 2 ...
#  $ Treatment: Factor w/ 2 levels "chilled","nonchilled": 2 2 2 2 2 2 2 2 2 2 ...
#  $ conc     : int  95 175 250 350 500 675 1000 95 175 250 ...
#  $ uptake   : num  16 30.4 34.8 37.2 35.3 39.2 39.7 13.6 27.3 37.1 ...
```
This shows the structure of the dataframe.
Very useful to check data type (mode) of all columns to make sure R loaded data properly.

.small[Note: the CO2 dataset includes repeated measurements of CO2 uptake from 6 plants from Quebec and 6 plants from Mississippi at several levels of CO2 concentration. Half the plants of each type were chilled overnight before the experiment was conducted.]


---
## Looking at Data

**Common problems:**

* Factors loaded as text (character) or vice versa
* Factor includes too many levels because of typo
* Data (integer or numeric) is loaded as character because of typo (e.g. a space or a "," instead of a "." for decimal numbers)


---
## Looking at Data

`data()`, `head()`, `tail()`, `str()`, `names()`, `attributes()`, `dim()`, `ncol()`, `nrow()`

Load the data with:


```r
CO2 &lt;- read.csv("co2_good.csv", header = FALSE)
```
Check data types with `str()` again. What is wrong here?

.comment[Don't forget to re-load data with `header = T` afterward]

---
## Reminder : Accessing data

A data frame called *mydata*

.center[
![:scale 45%](images/Table_Reminder_from_Workshop_1_Accessing_data.png)
]


```r
mydata[1,] # Extracts the first row
mydata[2,3] # Extracts the content of row 2 / column 3
mydata[,1] # Extracts the first column
mydata[,1][2] # [...] can be also be used recursively
mydata$Variable1 # Also extracts the first column
```

---
## Renaming variables

Variables names can be changed within R. 


```r
# First lets make a copy of the dataset to play with
CO2copy &lt;- CO2
# names() gives you the names of the variables present in the data frame 
names(CO2copy)
# [1] "Plant"     "Type"      "Treatment" "conc"      "uptake"

# Changing from English to French names (make sure you have the same levels!)
names(CO2copy) &lt;- c("Plante","Categorie", "Traitement", "conc","absortion")
```

---
## Creating new variables

Variables and strings can be concatenated together 
the function `paste()` is very useful for concatenating.
see `?paste` and `?paste0`


Let's create an unique id for our samples:

```r
# Don't forget to use "" for strings 
CO2copy$uniqueID &lt;- paste0(CO2copy$Plante,
                           "_",CO2copy$Categorie, 
                           "_", CO2copy$Traitement)

# observe the results 
head(CO2copy$uniqueID)
# [1] "Qn1_Quebec_nonchilled" "Qn1_Quebec_nonchilled" "Qn1_Quebec_nonchilled"
# [4] "Qn1_Quebec_nonchilled" "Qn1_Quebec_nonchilled" "Qn1_Quebec_nonchilled"
```

---
## Creating new variables

Creating new variables works for numbers and mathematical operations as well! 


```r
# Let's standardize our variable "absortion" to relative values 
CO2copy$absortionRel &lt;- CO2copy$absortion/max(CO2copy$absortion)  

# Observe the results 
head(CO2copy$absortionRel)
# [1] 0.3516484 0.6681319 0.7648352 0.8175824 0.7758242 0.8615385
```

---
## Subsetting data

There are many ways to subset a data frame 


```r
# Let's keep working with our CO2copy data frame 

# Select only "Plante" and "absortionRel" columns. (Don't forget the ","!)
CO2copy[,c("Plante", "absortionRel")] 

# Subset data frame from rows from 1 to 50 
CO2copy[1:50,] 

# Select observations matching only the nonchilled Traitement. 
CO2copy[CO2copy$Traitement == "nonchilled",] 

# Select observations with absortion higher or equal to 20 
CO2copy[CO2copy$absortion &gt;= 20, ]  

# Select observations with absortion higher or equal to 20 
CO2copy[CO2copy$Traitement  == "nonchilled" &amp; CO2copy$absortion &gt;= 20, ]

# We are done playing with the Dataset copy, lets erase it. 
CO2copy &lt;- NULL
```

Go [here](https://stat.ethz.ch/R-manual/R-devel/library/base/html/Logic.html) to check all the logical operators you can use 

---
## Data exploration

A good way to start your data exploration is to look at some basic statistics of your dataset 

Use the `summary()` function.  

This is also useful to spot some errors you might have missed! 


```r
summary(CO2)
#      Plant             Type         Treatment       conc     
#  Mc1    : 7   Mississippi:42   chilled   :42   Min.   :  95  
#  Mc2    : 7   Quebec     :42   nonchilled:42   1st Qu.: 175  
#  Mc3    : 7                                    Median : 350  
#  Mn1    : 7                                    Mean   : 435  
#  Mn2    : 7                                    3rd Qu.: 675  
#  Mn3    : 7                                    Max.   :1000  
#  (Other):42                                                  
#      uptake     
#  Min.   : 7.70  
#  1st Qu.:17.90  
#  Median :28.30  
#  Mean   :27.21  
#  3rd Qu.:37.12  
#  Max.   :45.50  
# 
```

---
## Data exploration

You can also use some other functions to calculate basic statistics to specific parts of your data frame

Let's try `mean()`, `sd()`, `hist()` , `print()` functions


```r
# Calculate mean and standard deviation of the concentration, 
# assign it to a new variable
meanConc &lt;- mean(CO2$conc)
sdConc &lt;- sd(CO2$conc)
# print() prints any given value to the R console
print(paste("the mean of concentration is:", meanConc))
# [1] "the mean of concentration is: 435"
print(paste("the standard deviation of concentration is:", sdConc))
# [1] "the standard deviation of concentration is: 295.924119222056"
```

---
## Data exploration


```r
# Let's plot a histogram to explore the distribution of "uptake"
hist(CO2$uptake, breaks = 40) # the argument breaks allows to change the number of bins
```

&lt;img src="Workshop02_Slides_files/figure-html/unnamed-chunk-21-1.png" width="480" style="display: block; margin: auto;" /&gt;


---
## Data exploration

The `apply()` function is used to apply a function to multiple columns or rows at the same time.


```r
?apply
```

Use `apply()` to calculate the means of the last two columns of the data frame (i.e. the columns that contain continuous data)


```r
apply(CO2[,4:5], MARGIN = 2, FUN = mean)
#     conc   uptake 
# 435.0000  27.2131
```

* `MARGIN = 1` ![:faic](arrow-right) if the function is applied to lines
* `MARGIN = 2` ![:faic](arrow-right) if the function is applied to columns

---
## Saving your Workspace



```r
# Saving an R workspace file
save.image(file="co2_project_Data.RData")


# Clear your memory
rm(list = ls())

 
# Reload your data
load("co2_project_Data.RData")
head(CO2) # looking good!
#   Plant   Type  Treatment conc uptake
# 1   Qn1 Quebec nonchilled   95   16.0
# 2   Qn1 Quebec nonchilled  175   30.4
# 3   Qn1 Quebec nonchilled  250   34.8
# 4   Qn1 Quebec nonchilled  350   37.2
# 5   Qn1 Quebec nonchilled  500   35.3
# 6   Qn1 Quebec nonchilled  675   39.2
```

---
## Exporting data


```r
write.csv(CO2, file = "co2_new.csv")
```

`CO2` ![:faic](arrow-right) Object (name)

`"co2_new.csv"` ![:faic](arrow-right) File to write (name)



---
## Challenge ![:cube]()

#### Use your data 

* Try to load, explore, plot, and save your own data in R*
* If it doesn’t load properly, try to make the appropriate changes
* Remember to clear your workspace first!
* When you are finished, try opening your exported data in excel

.comment[*If you don’t have your own data, work with your neighbour]

---
class: inverse, center, middle

# Fixing a broken data frame

---
## Challenge ![:cube]()

#### Fixing a broken data frame

Data can be messy. There are compatibility issues between different systems (Mac vs Windows) or different computers.

Let's practice how to solve this common errors. 

Read in the file "co2_broken.csv"


```r
CO2 &lt;- read.csv("co2_broken.csv")
```

---
## Challenge ![:cube]()


```r
head(CO2)
#               NOTE..It.rain.a.lot.in.Quebec.during.sampling
# 1 falling on my notebook numerous values can't be read rain
# 2                      Plant\tType\tTreatment\tconc\tuptake
# 3                           Qn1\tQuebec\tnonchilled\t95\t16
# 4                        Qn1\tQuebec\tnonchilled\t175\t30.4
# 5           Qn1\tQuebec\tnonchilled\t250\tcannot_read_notes
# 6                        Qn1\tQuebec\tnonchilled\t350\t37.2
#   due.to.excessive  X X.1 X.2 X.3
# 1               NA NA  NA  NA  NA
# 2               NA NA  NA  NA  NA
# 3               NA NA  NA  NA  NA
# 4               NA NA  NA  NA  NA
# 5               NA NA  NA  NA  NA
# 6               NA NA  NA  NA  NA
```

---
## Challenge ![:cube]()

* This is often what your data or the data you downloaded looks like
* You can fix the data frame in R (or not…)
* Please give it a try before looking at the script provided
* Work with your neighbors and have FUN!


```
#                NOTE..It.rain.a.lot.in.Quebec.during.sampling
# 1  falling on my notebook numerous values can't be read rain
# 2                       Plant\tType\tTreatment\tconc\tuptake
# 3                            Qn1\tQuebec\tnonchilled\t95\t16
# 4                         Qn1\tQuebec\tnonchilled\t175\t30.4
# 5            Qn1\tQuebec\tnonchilled\t250\tcannot_read_notes
# 6                         Qn1\tQuebec\tnonchilled\t350\t37.2
# 7                         Qn1\tQuebec\tnonchilled\t500\t35.3
# 8           Qn1\tQuebec\tnonchilled\tcannot_read_notes\t39.2
# 9                        Qn1\tQuebec\tnonchilled\t1000\t39.7
# 10                         Qn2\tQuebec\tnonchilled\t95\t13.6
# 11                        Qn2\tQuebec\tnonchilled\t175\t27.3
# 12                         Qn2\tQuebec\tnnchilled\t250\t37.1
# 13                        Qn2\tQuebec\tnonchilled\t350\t41.8
# 14                        Qn2\tQuebec\tnonchilled\t500\t40.6
# 15                          Qn2\tQuebec\tnonchilled\t675\tna
# 16                       Qn2\tQuebec\tnonchilled\t1000\t44.3
# 17                         Qn3\tQuebec\tnonchilled\t95\t16.2
# 18                        Qn3\tQuebec\tnonchilled\t175\t32.4
# 19                        Qn3\tQuebec\tnonchilled\t250\t40.3
# 20                        Qn3\tQuebec\tnonchilled\t350\t42.1
# 21                        Qn3\tQuebec\tnonchilled\t500\t42.9
# 22                        Qn3\tQuebec\tnonchilled\t675\t43.9
# 23                       Qn3\tQuebec\tnonchilled\t1000\t45.5
# 24                            Qc1\tQuebec\tchilled\t95\t14.2
# 25                           Qc1\tQuebec\tchilled\t175\t24.1
# 26             Qc1\tQuebec\tchilled\tcannot_read_notes\t30.3
# 27                           Qc1\tQuebec\tchilled\t350\t34.6
# 28                           Qc1\tQuebec\tchilled\t500\t32.5
# 29                           Qc1\tQuebec\tchilled\t675\t35.4
# 30                          Qc1\tQuebec\tchilled\t1000\t38.7
# 31                             Qc2\tQuebec\tchilled\t95\t9.3
# 32                           Qc2\tQuebec\tchilled\t175\t27.3
# 33                             Qc2\tQuebec\tchilled\t250\t35
# 34                           Qc2\tQuebec\tchilled\t350\t38.8
# 35                           Qc2\tQuebec\tchilled\t500\t38.6
# 36                           Qc2\tQuebec\tchilled\t675\t37.5
# 37                          Qc2\tQuebec\tchilled\t1000\t42.4
# 38                            Qc3\tQuebec\tchilled\t95\t15.1
# 39                             Qc3\tQuebec\tchilled\t175\t21
# 40                           Qc3\tQuebec\tchilled\t250\t38.1
# 41                             Qc3\tQuebec\tchilled\t350\t34
# 42                           Qc3\tQuebec\tchilled\t500\t38.9
# 43                           Qc3\tQuebec\tchilled\t675\t39.6
# 44                          Qc3\tQuebec\tchilled\t1000\t41.4
# 45                    Mn1\tMississippi\tnonchilled\t95\t10.6
# 46                   Mn1\tMississippi\tnonchilled\t175\t19.2
# 47                   Mn1\tMississippi\tnonchilled\t250\t26.2
# 48                     Mn1\tMississippi\tnonchilled\t350\t30
# 49                   Mn1\tMississippi\tnonchilled\t500\t30.9
# 50                   Mn1\tMississippi\tnonchilled\t675\t32.4
# 51                  Mn1\tMississippi\tnonchilled\t1000\t35.5
# 52                      Mn2\tMississippi\tnonchilled\t95\t12
# 53                     Mn2\tMississippi\tnonchilled\t175\t22
# 54                   Mn2\tMississippi\tnonchilled\t250\t30.6
# 55                   Mn2\tMississippi\tnonchilled\t350\t31.8
# 56                   Mn2\tMississippi\tnonchilled\t500\t32.4
# 57                   Mn2\tMississippi\tnonchilled\t675\t31.1
# 58                  Mn2\tMississippi\tnonchilled\t1000\t31.5
# 59                    Mn3\tMississippi\tnonchilled\t95\t11.3
# 60                   Mn3\tMississippi\tnonchilled\t175\t19.4
# 61                   Mn3\tMississippi\tnonchilled\t250\t25.8
# 62                   Mn3\tMississippi\tnonchilled\t350\t27.9
# 63                   Mn3\tMississippi\tnonchilled\t500\t28.5
# 64                   Mn3\tMississippi\tnonchilled\t675\t28.1
# 65                  Mn3\tMississippi\tnonchilled\t1000\t27.8
# 66                       Mc1\tMississippi\tchilled\t95\t10.5
# 67                       Mc1\tMississippi\tchiled\t175\t14.9
# 68                      Mc1\tMississippi\tchilled\t250\t18.1
# 69                      Mc1\tMississippi\tchilled\t350\t18.9
# 70                      Mc1\tMississippi\tchilled\t500\t19.5
# 71                      Mc1\tMississippi\tchilled\t675\t22.2
# 72                     Mc1\tMississippi\tchilled\t1000\t21.9
# 73                        Mc2\tMississippi\tchilled\t95\t7.7
# 74                      Mc2\tMississippi\tchilled\t175\t11.4
# 75                      Mc2\tMississippi\tchilled\t250\t12.3
# 76                        Mc2\tMississippi\tchilled\t350\t13
# 77                      Mc2\tMississippi\tchilled\t500\t12.5
# 78                      Mc2\tMississippi\tchilled\t675\t13.7
# 79                     Mc2\tMississippi\tchilled\t1000\t14.4
# 80                       Mc3\tMississippi\tchilled\t95\t10.6
# 81                        Mc3\tMississippi\tchilled\t175\t18
# 82                      Mc3\tMississippi\tchilled\t250\t17.9
# 83                      Mc3\tMississippi\tchilled\t350\t17.9
# 84                      Mc3\tMississippi\tchilled\t500\t17.9
# 85                      Mc3\tMississippi\tchilled\t675\t18.9
# 86                     Mc3\tMississippi\tchilled\t1000\t19.9
#    due.to.excessive  X X.1 X.2 X.3
# 1                NA NA  NA  NA  NA
# 2                NA NA  NA  NA  NA
# 3                NA NA  NA  NA  NA
# 4                NA NA  NA  NA  NA
# 5                NA NA  NA  NA  NA
# 6                NA NA  NA  NA  NA
# 7                NA NA  NA  NA  NA
# 8                NA NA  NA  NA  NA
# 9                NA NA  NA  NA  NA
# 10               NA NA  NA  NA  NA
# 11               NA NA  NA  NA  NA
# 12               NA NA  NA  NA  NA
# 13               NA NA  NA  NA  NA
# 14               NA NA  NA  NA  NA
# 15               NA NA  NA  NA  NA
# 16               NA NA  NA  NA  NA
# 17               NA NA  NA  NA  NA
# 18               NA NA  NA  NA  NA
# 19               NA NA  NA  NA  NA
# 20               NA NA  NA  NA  NA
# 21               NA NA  NA  NA  NA
# 22               NA NA  NA  NA  NA
# 23               NA NA  NA  NA  NA
# 24               NA NA  NA  NA  NA
# 25               NA NA  NA  NA  NA
# 26               NA NA  NA  NA  NA
# 27               NA NA  NA  NA  NA
# 28               NA NA  NA  NA  NA
# 29               NA NA  NA  NA  NA
# 30               NA NA  NA  NA  NA
# 31               NA NA  NA  NA  NA
# 32               NA NA  NA  NA  NA
# 33               NA NA  NA  NA  NA
# 34               NA NA  NA  NA  NA
# 35               NA NA  NA  NA  NA
# 36               NA NA  NA  NA  NA
# 37               NA NA  NA  NA  NA
# 38               NA NA  NA  NA  NA
# 39               NA NA  NA  NA  NA
# 40               NA NA  NA  NA  NA
# 41               NA NA  NA  NA  NA
# 42               NA NA  NA  NA  NA
# 43               NA NA  NA  NA  NA
# 44               NA NA  NA  NA  NA
# 45               NA NA  NA  NA  NA
# 46               NA NA  NA  NA  NA
# 47               NA NA  NA  NA  NA
# 48               NA NA  NA  NA  NA
# 49               NA NA  NA  NA  NA
# 50               NA NA  NA  NA  NA
# 51               NA NA  NA  NA  NA
# 52               NA NA  NA  NA  NA
# 53               NA NA  NA  NA  NA
# 54               NA NA  NA  NA  NA
# 55               NA NA  NA  NA  NA
# 56               NA NA  NA  NA  NA
# 57               NA NA  NA  NA  NA
# 58               NA NA  NA  NA  NA
# 59               NA NA  NA  NA  NA
# 60               NA NA  NA  NA  NA
# 61               NA NA  NA  NA  NA
# 62               NA NA  NA  NA  NA
# 63               NA NA  NA  NA  NA
# 64               NA NA  NA  NA  NA
# 65               NA NA  NA  NA  NA
# 66               NA NA  NA  NA  NA
# 67               NA NA  NA  NA  NA
# 68               NA NA  NA  NA  NA
# 69               NA NA  NA  NA  NA
# 70               NA NA  NA  NA  NA
# 71               NA NA  NA  NA  NA
# 72               NA NA  NA  NA  NA
# 73               NA NA  NA  NA  NA
# 74               NA NA  NA  NA  NA
# 75               NA NA  NA  NA  NA
# 76               NA NA  NA  NA  NA
# 77               NA NA  NA  NA  NA
# 78               NA NA  NA  NA  NA
# 79               NA NA  NA  NA  NA
# 80               NA NA  NA  NA  NA
# 81               NA NA  NA  NA  NA
# 82               NA NA  NA  NA  NA
# 83               NA NA  NA  NA  NA
# 84               NA NA  NA  NA  NA
# 85               NA NA  NA  NA  NA
# 86               NA NA  NA  NA  NA
```


---
## Fixing co2_broken ![:cube]()

Some useful functions:

* `?read.csv` - look at some of the options for how to load a .csv
* `head()` - first few rows
* `str()` - structure of data
* `class()` - class of the object
* `unique()` - unique observations
* `levels()` - levels of a factor
* `which()` - ask a question to your data frame
* `droplevels()` - get rid of undesired levels after subsetting factors

.alert[HINT] There are 4 problems!

---
## Broken data

.alert[ERROR 1]

The data appears to be lumped into one column


```r
head(CO2)
#               NOTE..It.rain.a.lot.in.Quebec.during.sampling
# 1 falling on my notebook numerous values can't be read rain
# 2                      Plant\tType\tTreatment\tconc\tuptake
# 3                           Qn1\tQuebec\tnonchilled\t95\t16
# 4                        Qn1\tQuebec\tnonchilled\t175\t30.4
# 5           Qn1\tQuebec\tnonchilled\t250\tcannot_read_notes
# 6                        Qn1\tQuebec\tnonchilled\t350\t37.2
#   due.to.excessive  X X.1 X.2 X.3
# 1               NA NA  NA  NA  NA
# 2               NA NA  NA  NA  NA
# 3               NA NA  NA  NA  NA
# 4               NA NA  NA  NA  NA
# 5               NA NA  NA  NA  NA
# 6               NA NA  NA  NA  NA
```

---
## Broken data

.alert[ERROR 1] - Solution

* Re-import the data, but specify the separation among entries
* The `sep` argument tells R what character separates the values on each line of the file
* Here, "TAB" was used instead of ","


```r
CO2 &lt;- read.csv("co2_broken.csv", sep = "")
```

---
## Broken data

.alert[ERROR 2]

The data does not start until the third line of the file, so you end up with notes on the file as the headings.


```r
head(CO2)
#     NOTE.     It       rain        a               lot    in. Quebec
# 1 falling     on         my notebook          numerous values  can't
# 2   Plant   Type  Treatment     conc            uptake              
# 3     Qn1 Quebec nonchilled       95                16              
# 4     Qn1 Quebec nonchilled      175              30.4              
# 5     Qn1 Quebec nonchilled      250 cannot_read_notes              
# 6     Qn1 Quebec nonchilled      350              37.2              
#   during sampling.      due to excessive X....
# 1     be      read rain,,,, NA        NA    NA
# 2                           NA        NA    NA
# 3                           NA        NA    NA
# 4                           NA        NA    NA
# 5                           NA        NA    NA
# 6                           NA        NA    NA
```


---
## Broken data

.alert[ERROR 2] - Solution

Skip two lines when loading the file using the "skip" argument:


```r
CO2 &lt;- read.csv("co2_broken.csv", sep = "", skip = 2)
head(CO2)
#   Plant   Type  Treatment              conc            uptake
# 1   Qn1 Quebec nonchilled                95                16
# 2   Qn1 Quebec nonchilled               175              30.4
# 3   Qn1 Quebec nonchilled               250 cannot_read_notes
# 4   Qn1 Quebec nonchilled               350              37.2
# 5   Qn1 Quebec nonchilled               500              35.3
# 6   Qn1 Quebec nonchilled cannot_read_notes              39.2
```

---
## Broken data

.alert[ERROR 3]

`conc` and `uptake` variables are considered factors instead of numbers, because there are comments in the numeric columns


```r
str(CO2)
# 'data.frame':	84 obs. of  5 variables:
#  $ Plant    : Factor w/ 12 levels "Mc1","Mc2","Mc3",..: 10 10 10 10 10 10 10 11 11 11 ...
#  $ Type     : Factor w/ 2 levels "Mississippi",..: 2 2 2 2 2 2 2 2 2 2 ...
#  $ Treatment: Factor w/ 4 levels "chiled","chilled",..: 4 4 4 4 4 4 4 4 4 3 ...
#  $ conc     : Factor w/ 8 levels "1000","175","250",..: 7 2 3 4 5 8 1 7 2 3 ...
#  $ uptake   : Factor w/ 77 levels "10.5","10.6",..: 15 39 76 54 50 61 63 9 32 53 ...
unique(CO2$conc) 
# [1] 95                175               250               350              
# [5] 500               cannot_read_notes 1000              675              
# Levels: 1000 175 250 350 500 675 95 cannot_read_notes
unique(CO2$uptake)
#  [1] 16                30.4              cannot_read_notes
#  [4] 37.2              35.3              39.2             
#  [7] 39.7              13.6              27.3             
# [10] 37.1              41.8              40.6             
# [13] na                44.3              16.2             
# [16] 32.4              40.3              42.1             
# [19] 42.9              43.9              45.5             
# [22] 14.2              24.1              30.3             
# [25] 34.6              32.5              35.4             
# [28] 38.7              9.3               35               
# [31] 38.8              38.6              37.5             
# [34] 42.4              15.1              21               
# [37] 38.1              34                38.9             
# [40] 39.6              41.4              10.6             
# [43] 19.2              26.2              30               
# [46] 30.9              35.5              12               
# [49] 22                30.6              31.8             
# [52] 31.1              31.5              11.3             
# [55] 19.4              25.8              27.9             
# [58] 28.5              28.1              27.8             
# [61] 10.5              14.9              18.1             
# [64] 18.9              19.5              22.2             
# [67] 21.9              7.7               11.4             
# [70] 12.3              13                12.5             
# [73] 13.7              14.4              18               
# [76] 17.9              19.9             
# 77 Levels: 10.5 10.6 11.3 11.4 12 12.3 12.5 13 13.6 13.7 14.2 ... na
```


---
## `?read.csv`

![:scale 80%](images/read_table_help1.png)

![:scale 80%](images/read_table_help2.png)


---
## Broken data

.alert[ERROR 3] - Solution

Tell R that all of NA, "na", and "cannot_read_notes" should be considered NA. Then because all other values in those columns are numbers, `conc` and `uptake` will be loaded as numeric/integer.



```r
CO2 &lt;- read.csv("co2_broken.csv", sep = "", skip = 2,
                na.strings = c("NA", "na", "cannot_read_notes"))
str(CO2)
# 'data.frame':	84 obs. of  5 variables:
#  $ Plant    : Factor w/ 12 levels "Mc1","Mc2","Mc3",..: 10 10 10 10 10 10 10 11 11 11 ...
#  $ Type     : Factor w/ 2 levels "Mississippi",..: 2 2 2 2 2 2 2 2 2 2 ...
#  $ Treatment: Factor w/ 4 levels "chiled","chilled",..: 4 4 4 4 4 4 4 4 4 3 ...
#  $ conc     : int  95 175 250 350 500 NA 1000 95 175 250 ...
#  $ uptake   : num  16 30.4 NA 37.2 35.3 39.2 39.7 13.6 27.3 37.1 ...
```

---
## Broken data

.alert[ERROR 4]

There are only 2 treatments (chilled and nonchilled) but there are spelling errors causing it to look like 4 different treatments.


```r
str(CO2)
```


```r
levels(CO2$Treatment)
# [1] "chiled"     "chilled"    "nnchilled"  "nonchilled"
unique(CO2$Treatment)
# [1] nonchilled nnchilled  chilled    chiled    
# Levels: chiled chilled nnchilled nonchilled
```

---
## Broken data

.alert[ERROR 4] - Solution



```r
# Identify all rows that contain "nnchilled" and replace with "nonchilled"
CO2$Treatment[CO2$Treatment=="nnchilled"] &lt;- "nonchilled"

# Identify all rows that contain "chiled" and replace with "chilled"
CO2$Treatment[CO2$Treatment=="chiled"] &lt;- "chilled"

# Drop unused levels from factor
levels(CO2$Treatment)
# [1] "chiled"     "chilled"    "nnchilled"  "nonchilled"
CO2 &lt;- droplevels(CO2)
levels(CO2$Treatment)
# [1] "chilled"    "nonchilled"
```


---
class: inverse, center, middle

# Manipulate data with `tidyr`, `dplyr`, `magrittr` 

---
## `tidyr` to reshape data frames


.center[
![:scale 45%](images/tidyr_logo.png) 
]

---
## Data formats


.pull-left[ 
**Wide format**

**Wide** data format has a separate column for each variable or each factor in your study

```
#   Species DBH Height
# 1     Oak  12     56
# 2     Elm  20     85
# 3     Ash  13     55
```
]

.pull-right[ 
**Long format**

**Long** data format has a column for possible variables and a column for the values of those variables

```
#   Species Measurement Value
# 1     Oak         DBH    12
# 2     Elm         DBH    20
# 3     Ash         DBH    13
# 4     Oak      Height    56
# 5     Elm      Height    85
# 6     Ash      Height    55
```
]

------------

Wide data frame can be used for some basic plotting in `ggplot2`, but more complex plots require long format (example to come)

`dplyr`, `lm()`, `glm()`, `gam()` all require long data format

---
## Tidying your data

`tidyr` allows you to manipulate the structure of your data while preserving all original information

`gather()` ![:faic](arrow-right) convert from wide to long format

`spread()` ![:faic](arrow-right) convert from long to wide format

.center[ 
![scale:90%](images/gather-spread.png)]

---
## `tidyr` installation


```r
install.packages("tidyr")
library(tidyr)
```

---
## `gather` columns into rows

`gather(data, key, value, ...)`

  - `data` ![:faic](arrow-right) A data frame (e.g. `wide`)   
  - `key` ![:faic](arrow-right) name of the new column containing variable names (e.g. `Measurement`)  
  - `value` ![:faic](arrow-right) name of the new column containing variable values (e.g. `Value`)   
  - `...` ![:faic](arrow-right) name or numeric index of the columns we wish to gather (e.g. `DBH`, `Height`)


---
## `gather` columns into rows


```r
wide &lt;- data.frame(Species = c("Oak", "Elm", "Ash"),
                   DBH = c(12, 20, 13), Height = c(56, 85, 55))
wide
#   Species DBH Height
# 1     Oak  12     56
# 2     Elm  20     85
# 3     Ash  13     55
```


```r
long = gather(wide, Measurement, Value, DBH, Height)
long
#   Species Measurement Value
# 1     Oak         DBH    12
# 2     Elm         DBH    20
# 3     Ash         DBH    13
# 4     Oak      Height    56
# 5     Elm      Height    85
# 6     Ash      Height    55
```

---
## `spread` rows into columns

`spread(data, key, value)`

  - `data` ![:faic](arrow-right) A data frame (e.g. `long`)   
  - `key` ![:faic](arrow-right) Name of the column containing variable names (e.g. `Measurement`)  
  - `value`![:faic](arrow-right)  Name of the column containing variable values (e.g. `Value`)   


---
## `spread` rows into columns


```r
long
#   Species Measurement Value
# 1     Oak         DBH    12
# 2     Elm         DBH    20
# 3     Ash         DBH    13
# 4     Oak      Height    56
# 5     Elm      Height    85
# 6     Ash      Height    55
wide2 &lt;- spread(long, Measurement, Value)
wide2
#   Species DBH Height
# 1     Ash  13     55
# 2     Elm  20     85
# 3     Oak  12     56
```

---
## `separate` columns

`separate()` splits a columns by a character string separator

.center[
![](images/separate.png)
]

`separate(data, col, into, sep)`

  - `data` ![:faic](arrow-right) A data frame (e.g. `long`)   
  - `col` ![:faic](arrow-right) Name of the column you wish to separate
  - `into` ![:faic](arrow-right) Names of new variables to create
  - `sep` ![:faic](arrow-right) Character which indicates where to separate  

---
## Using `separate()` example

Create a fictional dataset about fish and plankton

```r
set.seed(8)
messy &lt;- data.frame(id = 1:4,
                    trt = sample(rep(c('control', 'farm'), each = 2)),
                    zooplankton.T1 = runif(4),
                    fish.T1 = runif(4),
                    zooplankton.T2 = runif(4),
                    fish.T2 = runif(4))
messy
#   id     trt zooplankton.T1    fish.T1 zooplankton.T2     fish.T2
# 1  1 control      0.3215092 0.76914695      0.4323914 0.001301721
# 2  2 control      0.7189275 0.64449114      0.5449621 0.264458864
# 3  3    farm      0.2908734 0.45704489      0.1382243 0.276532247
# 4  4    farm      0.9322698 0.08930101      0.9278123 0.521107042
```

---
## Using `separate()` example

First convert the messy data frame from wide to long format


```r
messy.long &lt;- gather(messy, taxa, count, -id, -trt)
head(messy.long)
#   id     trt           taxa     count
# 1  1 control zooplankton.T1 0.3215092
# 2  2 control zooplankton.T1 0.7189275
# 3  3    farm zooplankton.T1 0.2908734
# 4  4    farm zooplankton.T1 0.9322698
# 5  1 control        fish.T1 0.7691470
# 6  2 control        fish.T1 0.6444911
```

---
## Using `separate()` example

Then we want to split the 2 sampling time (T1 and T2).


```r
messy.long.sep &lt;- separate(messy.long, taxa,
                           into = c("species", "time"), sep = "\\.")
head(messy.long.sep)
#   id     trt     species time     count
# 1  1 control zooplankton   T1 0.3215092
# 2  2 control zooplankton   T1 0.7189275
# 3  3    farm zooplankton   T1 0.2908734
# 4  4    farm zooplankton   T1 0.9322698
# 5  1 control        fish   T1 0.7691470
# 6  2 control        fish   T1 0.6444911
```

.comment[The argument `sep = "\\."` tells R to splits the character string around the period (.). We cannot type directly `sep = "."` because it is a regular expression that matches any single character (a joker).]


---
## Recap of `tidyr`

A package that reshapes the layout of data sets.

Converting from wide to long format using `gather()`

Converting from long format to wide format using `spread()`

Split and merge columns with `unite()` and `separate()`

[Data Wrangling with dplyr and tidyr Cheat Sheet](https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf)


---
## Challenge with `tidyr` ![:cube]()

1. Using the airquality dataset, `gather` all the columns (except Month and Day) into rows.

2. Then `spread` the resulting data frame to return to the original data format.


```r
?airquality

data(airquality)
```

---
## Solution

1. Using the airquality dataset, `gather` all the columns (except Month and Day) into rows.

```r
air.long &lt;- gather(airquality, variable, value, -Month, -Day)
head(air.long)
#   Month Day variable value
# 1     5   1    Ozone    41
# 2     5   2    Ozone    36
# 3     5   3    Ozone    12
# 4     5   4    Ozone    18
# 5     5   5    Ozone    NA
# 6     5   6    Ozone    28
```

.comment[Note that the syntax used here indicates that we wish to gather ALL the columns exept *Month* and *Day*. It is equivalent to: `gather(airquality, value, Ozone, Solar.R, Temp, Wind)`]




---
## Solution

2. Then `spread` the resulting data frame to return to the original data format.


```r
air.wide &lt;- spread(air.long, variable, value)
head(air.wide)
#   Month Day Ozone Solar.R Temp Wind
# 1     5   1    41     190   67  7.4
# 2     5   2    36     118   72  8.0
# 3     5   3    12     149   74 12.6
# 4     5   4    18     313   62 11.5
# 5     5   5    NA      NA   56 14.3
# 6     5   6    28      NA   66 14.9
```


---
## Data manipulation with `dplyr`

.center[
![:scale 50%](images/dplyr.png)]

---
## Intro to `dplyr`

- Package that contains a set of functions (or “verbs”) for data manipulation such as filtering rows, selecting specific columns, re-ordering rows, adding new columns and summarizing data;
- Easy and intuitive functions
- Fast and efficient
- Can interface with external databases and translate your R code into SQL queries

Some corresponding R base functions:
`split()`, `subset()`, `apply()`, `sapply()`, `lapply()`, `tapply()` and `aggregate()`

---
## Intro to `dplyr`


```r
install.packages("dplyr")
library(dplyr)
```

---
## Basic functions in `dplyr`

These 4 core functions tackle the most common manipulations when working with data frames

  * `select()`: select columns from a data frame
  * `filter()`: filter rows according to defined criteria
  * `arrange()`: re-order data based on criteria (e.g. ascending, descending)
  * `mutate()`: create or transform values in a column

---
## `select` columns

.center[![:scale 60%](images/select.png)]

`select(data, ...)`

  * `...`  Can be column names or positions or complex expressions separated by commas

  `select(data, column1, column2)` select columns 1 and 2
  `select(data, c(2:4,6))` select columns 2 to 4 and 6
  `select(data, -column1)` select all columns except column 1
  `select(data, start_with(x.))` select all columns that start with "x."

---
## `select` columns

.center[![:scale 70%](images/select.helper.png)]


---
## `select` columns

Example: suppose we are only interested in the variation of Ozone over time within the airquality dataset


```r
ozone &lt;- select(airquality, Ozone, Month, Day)
head(ozone)
#   Ozone Month Day
# 1    41     5   1
# 2    36     5   2
# 3    12     5   3
# 4    18     5   4
# 5    NA     5   5
# 6    28     5   6
```

---
## `filter` rows

Extract a subset of rows that meet one or more specific conditions

`filter(dataframe, logical statement 1, logical statement 2, ...)`

.center[![:scale 90%](images/filter.png)]

.center[![:scale 90%](images/logic.helper.png)]


---
## `filter` rows

Example: we are interested in analyses that focus on the month of August during high temperature events


```r
august &lt;- filter(airquality, Month == 8, Temp &gt;= 90)
# same as: filter(airquality, Month == 8 &amp; Temp &gt;= 90)
head(august)
#   Ozone Solar.R Wind Temp Month Day
# 1    89     229 10.3   90     8   8
# 2   110     207  8.0   90     8   9
# 3    NA     222  8.6   92     8  10
# 4    76     203  9.7   97     8  28
# 5   118     225  2.3   94     8  29
# 6    84     237  6.3   96     8  30
```

---
## Sort rows with `arrange`

Re-order rows by a particular column, by default in ascending order

Use `desc()` for descending order.

`arrange(data, variable1, desc(variable2), ...)`

---
## Sort rows with `arrange`

Example:
1. Let's use the following code to create a scrambled version of the airquality dataset


```r
air_mess &lt;- sample_frac(airquality, 1)
head(air_mess)
#     Ozone Solar.R Wind Temp Month Day
# 35     NA     186  9.2   84     6   4
# 63     49     248  9.2   85     7   2
# 93     39      83  6.9   81     8   1
# 33     NA     287  9.7   74     6   2
# 99    122     255  4.0   89     8   7
# 145    23      14  9.2   71     9  22
```

---
## Sort rows with `arrange`

Example:
2. Now let's arrange the data frame back into chronological order, sorting by Month then Day


```r
air_chron &lt;- arrange(air_mess, Month, Day)
head(air_chron)
#   Ozone Solar.R Wind Temp Month Day
# 1    41     190  7.4   67     5   1
# 2    36     118  8.0   72     5   2
# 3    12     149 12.6   74     5   3
# 4    18     313 11.5   62     5   4
# 5    NA      NA 14.3   56     5   5
# 6    28      NA 14.9   66     5   6
```

Try :  `arrange(air_mess, Day, Month)` and see the difference.

---
## Create new columns using `mutate`

Compute and add new columns

`mutate(data, newVar1 = expression1, newVar2 = expression2, ...)`

.center[![](images/mutate.png)]


---
## Create new columns using `mutate`

Example: we want to convert the temperature variable form degrees Fahrenheit to degrees Celsius


```r
airquality_C &lt;- mutate(airquality, Temp_C = (Temp-32)*(5/9))
head(airquality_C)
#   Ozone Solar.R Wind Temp Month Day   Temp_C
# 1    41     190  7.4   67     5   1 19.44444
# 2    36     118  8.0   72     5   2 22.22222
# 3    12     149 12.6   74     5   3 23.33333
# 4    18     313 11.5   62     5   4 16.66667
# 5    NA      NA 14.3   56     5   5 13.33333
# 6    28      NA 14.9   66     5   6 18.88889
```

---
## `magrittr`

.center[
![:scale 60%](images/magrittr.png)]
Usually data manipulation require multiple steps, the magrittr package offers a pipe operator `%&gt;%` which allows us to link multiple operations

---
## `magrittr`


```r
install.packages("magrittr")
require(magrittr)
```

---
## `magrittr`

Suppose we want to analyse only the month of June, then convert the temperature variable to degrees Celsius. We can create the required data frame by combining 2 dplyr verbs we learned


```r
june_C &lt;- mutate(filter(airquality, Month == 6),
                 Temp_C = (Temp-32)*(5/9))
```

As we add more operations, wrapping functions one inside the other becomes increasingly illegible. But, step by step would be redundant and write a lot of objects to the workspace.

---
## `magrittr`

Alternatively, we can use maggritr's pipe operator to link these successive operations


```r
june_C &lt;- airquality %&gt;%
    filter(Month == 6) %&gt;%
    mutate(Temp_C = (Temp-32)*(5/9))
```

Advantages :

  * less redundant code
  * easy to read and write because functions are executed in order

---
## `dplyr::group_by` and `summarise`

The `dplyr` verbs become especially powerful when they are are combined using the pipe operator `%&gt;%`.
The following `dplyr` functions allow us to split our data frame into groups on which we can perform operations individually

`group_by()` ![:faic](arrow-right) group data frame by a factor for downstream operations (usually summarise)

`summarise()` ![:faic](arrow-right) summarise values in a data frame or in groups within the data frame with aggregation functions (e.g. `min()`, `max()`, `mean()`)

---
## `dplyr` - Split-Apply-Combine

The `group_by` function is key to the Split-Apply-Combine strategy

.center[
![](images/split-apply-combine.png)
]


---
## `dplyr` - Split-Apply-Combine

.center[
![:scale 70%](images/summarise.png)]

---
## `dplyr` - Split-Apply-Combine

Example: we are interested in the mean temperature and standard deviation within each month if the airquality dataset


```r
month_sum &lt;- airquality %&gt;%
      group_by(Month) %&gt;%
      summarise(mean_temp = mean(Temp),
                sd_temp = sd(Temp))
month_sum
# # A tibble: 5 x 3
#   Month mean_temp sd_temp
#   &lt;int&gt;     &lt;dbl&gt;   &lt;dbl&gt;
# 1     5      65.5    6.85
# 2     6      79.1    6.60
# 3     7      83.9    4.32
# 4     8      84.0    6.59
# 5     9      76.9    8.36
```

---
## Challenge - `dplyr`and `magrittr` ![:cube]()

Using the `ChickWeight` dataset, create a summary table which displays the difference in weight between the maximum and minimum weight of each chick in the study.

Employ `dplyr` verbs and the `%&gt;%` operator.

---
## Solution

1. Use group_by() to divide the dataset by "Chick"
2. Use summarise() to calculate the weight gain within each group


```r
weight_diff &lt;- ChickWeight %&gt;%
      group_by(Chick) %&gt;%
      summarise(weight_diff = max(weight) - min(weight))
head(weight_diff)
# # A tibble: 6 x 2
#   Chick weight_diff
#   &lt;ord&gt;       &lt;dbl&gt;
# 1 18              4
# 2 16             16
# 3 15             27
# 4 13             55
# 5 9              58
# 6 20             76
```

---
## Ninja challenge ![:cube]()

- Using the `ChickWeight` dataset, create a summary table which displays, for each diet, the average individual difference in weight between the end and the beginning of the study.

- Employ `dplyr` verbs and the `%&gt;%` operator.

.comment[Hint] `first()` and `last()` may be useful here

---
## Ninja solution


```r
diet_summ &lt;- ChickWeight %&gt;%
      group_by(Diet, Chick) %&gt;%
      summarise(weight_gain = last(weight) - first(weight)) %&gt;%
      group_by(Diet) %&gt;%
      summarise(mean_gain = mean(weight_gain))
diet_summ
# # A tibble: 4 x 2
#   Diet  mean_gain
#   &lt;fct&gt;     &lt;dbl&gt;
# 1 1          115.
# 2 2          174 
# 3 3          230.
# 4 4          188.
```

---
## More on data manipulation

[Learn more on dplyr](http://r4ds.had.co.nz/transform.html)

[dplyr and tidyr cheatsheet](https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf)




---
class: inverse, center, bottom

# Thank you for attending!

![:scale 50%](images/qcbs_logo.png)
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="qcbsR-macros.js"></script>
<script>var slideshow = remark.create();
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
  }
});
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
